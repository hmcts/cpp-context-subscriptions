name: CPP Context Verify & Validation

# Need to update this for actual migration
trigger:
  branches:
    include:
      - main
      - 'team/*'
    exclude:
      - 'dev/release-*'
  paths:
    include:
    - '*'

pr:
  - '*'

resources:
  repositories:
    - repository: cppAzureDevOpsTemplates
      type: github
      name: hmcts/cpp-azure-devops-templates
      endpoint: 'hmcts'
      ref: 'main'

pool:
  name: "MDV-ADO-AGENT-AKS-01"
  demands:
    - identifier -equals centos8-j17

variables:
  sonarqubeProject: "uk.gov.moj.cpp.subscriptions:subscriptions-parent"
  service_Name: 'subscriptions'
  itTest_Folder: 'subscriptions-integration-test'
  LANG : 'en_GB.UTF-8'
  LC_ALL : 'en_GB.UTF-8'

stages:
  - ${{ if eq(variables['Build.Reason'], 'PullRequest') }}:
      - template: pipelines/context-verify.yaml@cppAzureDevOpsTemplates
        parameters:
          sonarqube_project: ${{ variables['sonarqubeProject'] }}
          sonarQubeType: 'sonarQubeAKS'

  - ${{ if eq(variables['Build.Reason'], 'IndividualCI') }}:
      - template: pipelines/context-validation.yaml@cppAzureDevOpsTemplates
        parameters:
          repo: "$(Build.Repository.Name)"
          sonarQubeType: 'sonarQubeAKS'
          serviceName: ${{ variables['service_Name'] }}
          itTestFolder: ${{ variables['itTest_Folder'] }}
